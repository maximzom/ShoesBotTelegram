# üëü StepRight Telegram Bot

–ü–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂—É –≤–∑—É—Ç—Ç—è –∑ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª–ª—é, —Å–∏—Å—Ç–µ–º–æ—é –∑–∞–º–æ–≤–ª–µ–Ω—å —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é –ø–ª–∞—Ç–µ–∂—ñ–≤.

## üìã –ó–º—ñ—Å—Ç

- [–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ](#–æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó](#—Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó)
- [–®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç](#—à–≤–∏–¥–∫–∏–π-—Å—Ç–∞—Ä—Ç)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç—É)
- [–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è](#–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è)
- [–ö–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞](#–∫–æ–º–∞–Ω–¥–∏-–±–æ—Ç–∞)
- [–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö](#–±–∞–∑–∞-–¥–∞–Ω–∏—Ö)
- [–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è](#—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
- [–†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è](#—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è)
- [–ë–µ–∑–ø–µ–∫–∞](#–±–µ–∑–ø–µ–∫–∞)

## ‚ú® –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- üõçÔ∏è –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ –∑ —Ñ–æ—Ç–æ —Ç–∞ –æ–ø–∏—Å–∞–º–∏
- üì¶ –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- üë§ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–µ—Å—ñ—ó)
- üîê –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É
- üí≥ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Telegram Payments (stub + ready-to-use)
- üìä –ï–∫—Å–ø–æ—Ä—Ç –∑–∞–º–æ–≤–ª–µ–Ω—å —É CSV
- üéüÔ∏è –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤
- üìù –ó–±—ñ—Ä –≤—ñ–¥–≥—É–∫—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- üåê –ú—É–ª—å—Ç–∏–º–æ–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ (—Å–∫–µ–ª–µ—Ç)
- üîí Rate limiting –∑–∞—Ö–∏—Å—Ç
- üìà –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –¥—ñ–π
- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö (—Ü—ñ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω–∏, —Ä–æ–∑–º—ñ—Ä–∏)
- üíæ Persistent storage (–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É)

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **Python 3.10+**
- **pyTelegramBotAPI** (Telebot) - –æ—Å–Ω–æ–≤–Ω–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **SQLAlchemy** - ORM –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ë–î
- **SQLite** - –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- **pytest** - —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- **python-dotenv** - –∫–µ—Ä—É–≤–∞–Ω–Ω—è env –∑–º—ñ–Ω–Ω–∏–º–∏

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
# –ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
git clone <your-repo-url>
cd shoe_bot

# –°—Ç–≤–æ—Ä—ñ—Ç—å –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# –∞–±–æ
venv\Scripts\activate  # Windows

# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
pip install -r requirements.txt
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

```bash
# –°–∫–æ–ø—ñ—é–π—Ç–µ –ø—Ä–∏–∫–ª–∞–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
cp .env.example .env

# –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ .env —Ñ–∞–π–ª
nano .env
```

–ü—Ä–∏–∫–ª–∞–¥ `.env`:
```env
BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
ADMIN_IDS=123456789,987654321
DB_URL=sqlite:///data/shop.db
PAYMENT_PROVIDER_TOKEN=
LOG_LEVEL=INFO
RATE_LIMIT_MESSAGES=20
RATE_LIMIT_WINDOW=60
```

### 3. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```bash
# –°—Ç–≤–æ—Ä—ñ—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è –ë–î
mkdir -p data

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–π—Ç–µ —Å—Ö–µ–º—É
python -c "from models.db import init_db; init_db()"

# –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π —Å–∫—Ä–∏–ø—Ç
python scripts/migrate.py
```

### 4. –î–æ–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏

```bash
# –ß–µ—Ä–µ–∑ SQL
sqlite3 data/shop.db < scripts/seed_data.sql

# –ê–±–æ —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω-–∫–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞ –ø—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É
```

### 5. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python bot.py
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
shoe_bot/
‚îú‚îÄ‚îÄ README.md                    # –¶—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ requirements.txt             # Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ seed_data.sql                # –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
‚îú‚îÄ‚îÄ init_database.sql            # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ bot.py                       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
‚îú‚îÄ‚îÄ config.py                    # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ
‚îú‚îÄ‚îÄ models/                      # –ú–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö
‚îÇ   ‚îú‚îÄ‚îÄ db.py                   # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ schemas.py              # SQLAlchemy –º–æ–¥–µ–ª—ñ
‚îÇ
‚îú‚îÄ‚îÄ handlers/                    # –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ promo.py                # /promo
‚îÇ   ‚îú‚îÄ‚îÄ start.py                # /start, /help, /info
‚îÇ   ‚îú‚îÄ‚îÄ catalog.py              # /catalog, –ø–µ—Ä–µ–≥–ª—è–¥ —Ç–æ–≤–∞—Ä—ñ–≤
‚îÇ   ‚îú‚îÄ‚îÄ orders.py               # /order, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ admin.py                # /admin, –∫–µ—Ä—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îî‚îÄ‚îÄ feedback.py             # /feedback
‚îÇ
‚îú‚îÄ‚îÄ services/                    # –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ check_database.py       # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
‚îÇ   ‚îú‚îÄ‚îÄ product_service.py      # –†–æ–±–æ—Ç–∞ –∑ —Ç–æ–≤–∞—Ä–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ order_service.py        # –û–±—Ä–æ–±–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å
‚îÇ   ‚îú‚îÄ‚îÄ user_service.py         # –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
‚îÇ   ‚îú‚îÄ‚îÄ payment_service.py      # –ü–ª–∞—Ç–µ–∂—ñ
‚îÇ   ‚îî‚îÄ‚îÄ promo_service.py        # –ü—Ä–æ–º–æ–∫–æ–¥–∏
‚îÇ
‚îú‚îÄ‚îÄ utils/                       # –î–æ–ø–æ–º—ñ–∂–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ command_matcher.py      # –ü–æ–∫—Ä–∞—â–µ–Ω–µ —Å–ø—ñ–≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥ —ñ–∑ —Å–∏–Ω–æ–Ω—ñ–º–∞–º–∏ —Ç–∞ –Ω–µ—á—ñ—Ç–∫–∏–º —Å–ø—ñ–≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—è–º.
‚îÇ   ‚îú‚îÄ‚îÄ validators.py           # –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py            # –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
‚îÇ   ‚îú‚îÄ‚îÄ helpers.py              # –ó–∞–≥–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ user_utils.py           # –£—Ç–∏–ª—ñ—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö.
‚îÇ   ‚îú‚îÄ‚îÄ rate_limiter.py         # –û–±–º–µ–∂–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è–º.
‚îÇ   ‚îî‚îÄ‚îÄ locales.py              # –ú–æ–≤–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏
‚îÇ
‚îú‚îÄ‚îÄ data/                        # –î–∞–Ω—ñ
‚îÇ   ‚îî‚îÄ‚îÄ shop.db                 # SQLite –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
‚îÇ
‚îú‚îÄ‚îÄ logs/                        # –õ–æ–≥–∏
‚îÇ   ‚îî‚îÄ‚îÄ bot.log
‚îÇ
‚îú‚îÄ‚îÄ tests/                       # –¢–µ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_validators.py
‚îÇ   ‚îú‚îÄ‚îÄ test_order_service.py
‚îÇ   ‚îî‚îÄ‚îÄ test_handlers.py
‚îÇ
‚îî‚îÄ‚îÄ scripts/                     # –°–∫—Ä–∏–ø—Ç–∏
    ‚îú‚îÄ‚îÄ migrate.py              # –ú—ñ–≥—Ä–∞—Ü—ñ—ó
    ‚îú‚îÄ‚îÄ seed_data.sql           # –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
    ‚îú‚îÄ‚îÄ backup_orders.py        # –ë–µ–∫–∞–ø –∑–∞–º–æ–≤–ª–µ–Ω—å
    ‚îî‚îÄ‚îÄ export_csv.py           # –ï–∫—Å–ø–æ—Ä—Ç —É CSV
```

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è Bot Token

1. –ó–Ω–∞–π–¥—ñ—Ç—å [@BotFather](https://t.me/botfather) —É Telegram
2. –í—ñ–¥–ø—Ä–∞–≤—Ç–µ `/newbot`
3. –î–∞–π—Ç–µ —ñ–º'—è –≤–∞—à–æ–º—É –±–æ—Ç—É
4. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ç–æ–∫–µ–Ω —É `.env` —Ñ–∞–π–ª

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤

–î—ñ–∑–Ω–∞–π—Ç–µ—Å—å —Å–≤—ñ–π Telegram ID:
- –ù–∞–ø–∏—à—ñ—Ç—å [@userinfobot](https://t.me/userinfobot)
- –°–∫–æ–ø—ñ—é–π—Ç–µ ID —É `ADMIN_IDS` —á–µ—Ä–µ–∑ –∫–æ–º—É

### –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

**SQLite (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º):**
```env
DB_URL=sqlite:///data/shop.db
```

**PostgreSQL (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):**
```env
DB_URL=postgresql://user:password@localhost:5432/shoebot
```

–î–ª—è PostgreSQL –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤–æ:
```bash
pip install psycopg2-binary
```

## ü§ñ –ö–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞

### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –∫–æ–º–∞–Ω–¥–∏

| –ö–æ–º–∞–Ω–¥–∞     | –û–ø–∏—Å                                 |
|-------------|--------------------------------------|
| `/start`    | –ü–æ—á–∞—Ç–∫–æ–≤–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è —Ç–∞ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é |
| `/help`     | –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ —Ç–∞ —ó—Ö –æ–ø–∏—Å             |
| `/info`     | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –º–∞–≥–∞–∑–∏–Ω               |
| `/catalog`  | –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä—ñ–≤                      |
| `/promo`    | –ü–µ—Ä–µ–≥–ª—è–¥ –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤                  |
| `/order`    | –ü–æ—á–∞—Ç–∏ –Ω–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è               |
| `/feedback` | –ó–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫                      |
| `/hello`    | –î—Ä—É–∂–Ω—î –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è                    |

### –ê–¥–º—ñ–Ω-–∫–æ–º–∞–Ω–¥–∏

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å |
|---------|------|
| `/admin` | –í—ñ–¥–∫—Ä–∏—Ç–∏ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å |
| `/add_item` | –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä |
| `/remove_item` | –í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä |
| `/orders` | –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è |
| `/promo_add` | –î–æ–¥–∞—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥ |

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

### –°—Ö–µ–º–∞

```sql
-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    tg_id INTEGER UNIQUE NOT NULL,
    username TEXT,
    first_name TEXT,
    last_name TEXT,
    phone TEXT,
    language TEXT DEFAULT 'uk',
    state TEXT,
    state_data TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –¢–æ–≤–∞—Ä–∏
CREATE TABLE items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sku TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    description TEXT,
    price REAL NOT NULL,
    sizes TEXT NOT NULL,  -- JSON: ["38", "39", "40"]
    images TEXT,          -- JSON: ["file_id_1", "file_id_2"]
    category TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ö–æ—à–∏–∫–∏
CREATE TABLE carts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- –ü–æ–∑–∏—Ü—ñ—ó –≤ –∫–æ—à–∏–∫—É
CREATE TABLE cart_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    cart_id INTEGER NOT NULL,
    item_id INTEGER NOT NULL,
    size TEXT NOT NULL,
    quantity INTEGER DEFAULT 1,
    FOREIGN KEY (cart_id) REFERENCES carts(id),
    FOREIGN KEY (item_id) REFERENCES items(id)
);

-- –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è
CREATE TABLE orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_number TEXT UNIQUE NOT NULL,
    user_id INTEGER NOT NULL,
    total REAL NOT NULL,
    status TEXT DEFAULT 'pending',  -- pending/confirmed/paid/shipped/cancelled
    delivery_method TEXT,
    address TEXT,
    phone TEXT,
    promo_code TEXT,
    discount REAL DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- –ü–æ–∑–∏—Ü—ñ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
CREATE TABLE order_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id INTEGER NOT NULL,
    item_id INTEGER NOT NULL,
    size TEXT NOT NULL,
    quantity INTEGER NOT NULL,
    price REAL NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (item_id) REFERENCES items(id)
);

-- –í—ñ–¥–≥—É–∫–∏
CREATE TABLE feedback (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    text TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- –ü—Ä–æ–º–æ–∫–æ–¥–∏
CREATE TABLE promo_codes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code TEXT UNIQUE NOT NULL,
    discount_percent REAL NOT NULL,
    valid_until TIMESTAMP,
    usage_limit INTEGER,
    usage_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### –ú—ñ–≥—Ä–∞—Ü—ñ—è SQLite ‚Üí PostgreSQL

```bash
# 1. –ï–∫—Å–ø–æ—Ä—Ç—É–π—Ç–µ –¥–∞–Ω—ñ
python scripts/export_sqlite_to_sql.py

# 2. –°—Ç–≤–æ—Ä—ñ—Ç—å PostgreSQL –±–∞–∑—É
createdb shoebot

# 3. –Ü–º–ø–æ—Ä—Ç—É–π—Ç–µ —Å—Ö–µ–º—É
psql shoebot < scripts/postgres_schema.sql

# 4. –Ü–º–ø–æ—Ä—Ç—É–π—Ç–µ –¥–∞–Ω—ñ
psql shoebot < scripts/exported_data.sql
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ç–µ—Å—Ç–∏
pytest

# –ó –ø–æ–∫—Ä–∏—Ç—Ç—è–º –∫–æ–¥—É
pytest --cov=. --cov-report=html

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–µ—Å—Ç
pytest tests/test_validators.py -v

# –ó –≤–∏–≤–æ–¥–æ–º print
pytest -s
```

### –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—ñ–≤

```python
# –¢–µ—Å—Ç –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
def test_phone_validation():
    assert validate_phone("+380501234567") == True
    assert validate_phone("invalid") == False

# –¢–µ—Å—Ç —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Å—É–º–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
def test_order_total_calculation():
    items = [{"price": 1000, "quantity": 2}]
    assert calculate_total(items) == 2000

# –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π —Ç–µ—Å—Ç
def test_catalog_handler(mock_bot):
    message = create_mock_message("/catalog")
    catalog_handler(message)
    assert mock_bot.send_message.called
```

## üîí –ë–µ–∑–ø–µ–∫–∞

### –û–±–æ–≤'—è–∑–∫–æ–≤—ñ –∑–∞—Ö–æ–¥–∏

1. **–ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º—ñ—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª**
   ```bash
   echo ".env" >> .gitignore
   ```

2. **–ü—Ä–∏—Ö–æ–≤—É–π—Ç–µ —Ç–æ–∫–µ–Ω–∏ –≤ –ª–æ–≥–∞—Ö**
   ```python
   # –§—ñ–ª—å—Ç—Ä—É–π—Ç–µ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ
   logger.info(f"User {user_id} ordered")  # ‚úÖ
   logger.info(f"Token: {token}")  # ‚ùå
   ```

3. **–í–∞–ª—ñ–¥—É–π—Ç–µ –≤—Å—ñ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ**
   ```python
   if not validate_phone(phone):
       bot.reply_to(message, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω—É")
       return
   ```

4. **–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**
   ```python
   def is_admin(user_id):
       return user_id in config.ADMIN_IDS
   ```

5. **Rate limiting**
   ```python
   @rate_limit(max_calls=20, period=60)
   def handle_message(message):
       ...
   ```

6. **SQL Injection –∑–∞—Ö–∏—Å—Ç**
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ ORM (SQLAlchemy)
   - –ù—ñ–∫–æ–ª–∏ –Ω–µ –≤—Å—Ç–∞–≤–ª—è–π—Ç–µ user input –Ω–∞–ø—Ä—è–º—É –≤ SQL

7. **–ú–∞—Å–∫—É–π—Ç–µ PII –≤ –ª–æ–≥–∞—Ö**
   ```python
   phone_masked = phone[:3] + "****" + phone[-2:]
   ```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é–π—Ç–µ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ: `pip install --upgrade -r requirements.txt`
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ HTTPS –¥–ª—è webhook
- –ù–∞–ª–∞—à—Ç—É–π—Ç–µ backup –±–∞–∑–∏ –¥–∞–Ω–∏—Ö: `scripts/backup_orders.py`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Sentry –¥–ª—è tracking –ø–æ–º–∏–ª–æ–∫

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è

### –õ–æ–≥—É–≤–∞–Ω–Ω—è

–ë–æ—Ç –ª–æ–≥—É—î –≤—Å—ñ –≤–∞–∂–ª–∏–≤—ñ –ø–æ–¥—ñ—ó:

```python
# logs/bot.log
2024-01-15 10:30:45 INFO User 123456 started bot
2024-01-15 10:31:12 INFO User 123456 viewed catalog
2024-01-15 10:32:05 INFO Order #ORD-20240115-001 created by user 123456
2024-01-15 10:32:06 INFO Admin 987654 notified about order #ORD-20240115-001
```

### –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö

```bash
# –ï–∫—Å–ø–æ—Ä—Ç –≤—Å—ñ—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å
python scripts/export_csv.py --output orders.csv

# –ë–µ–∫–∞–ø –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
python scripts/backup_orders.py --date 2024-01-15
```

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω
python -c "from config import BOT_TOKEN; print('Token OK' if BOT_TOKEN else 'Token missing')"

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑'—î–¥–Ω–∞–Ω–Ω—è
python -c "import telebot; bot = telebot.TeleBot('YOUR_TOKEN'); print(bot.get_me())"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –Ω–µ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è

```bash
# –°—Ç–≤–æ—Ä—ñ—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –≤—Ä—É—á–Ω—É
mkdir -p data

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–π—Ç–µ –ë–î
python -c "from models.db import init_db; init_db()"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ê–¥–º—ñ–Ω-–∫–æ–º–∞–Ω–¥–∏ –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ ADMIN_IDS
echo $ADMIN_IDS

# –î—ñ–∑–Ω–∞–π—Ç–µ—Å—å —Å–≤—ñ–π ID —á–µ—Ä–µ–∑ @userinfobot
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–º–∏–ª–∫–∏ –ø—Ä–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
# –û–Ω–æ–≤—ñ—Ç—å pip
pip install --upgrade pip

# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –ø–æ –æ–¥–Ω—ñ–π
pip install pyTelegramBotAPI
pip install SQLAlchemy
pip install python-dotenv
```

## üìù TODO –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

- [ ] –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ payment provider (Stripe/LiqPay)
- [ ] –î–æ–¥–∞—Ç–∏ webhook –∑–∞–º—ñ—Å—Ç—å polling –¥–ª—è –∫—Ä–∞—â–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Sentry –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–æ–º–∏–ª–æ–∫
- [ ] –î–æ–¥–∞—Ç–∏ Redis –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ rate limiting
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤–Ω—É –º—É–ª—å—Ç–∏–º–æ–≤–Ω—ñ—Å—Ç—å
- [ ] –î–æ–¥–∞—Ç–∏ analytics dashboard
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ CI/CD pipeline
- [ ] –î–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ —Ç–µ—Å—Ç—ñ–≤ (–ø–æ–∫—Ä–∏—Ç—Ç—è >80%)
- [ ] –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –¥–æ –ë–î (—ñ–Ω–¥–µ–∫—Å–∏)
- [ ] –î–æ–¥–∞—Ç–∏ backup –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–ü–∏—Ç–∞–Ω–Ω—è? –ü—Ä–æ–±–ª–µ–º–∏? –°—Ç–≤–æ—Ä—ñ—Ç—å Issue —É GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó.

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT License - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –≤—ñ–ª—å–Ω–æ –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ç–∞ –∫–æ–º–µ—Ä—Ü—ñ–π–Ω–∏—Ö —Ü—ñ–ª–µ–π.

